{% extends "baseprojectpage.html" %}
{% load projecttags %}
{% load humanize %}
{% load static %}
{% block localbreadcrumb %}
<li>All compatible machines</li>
{% endblock %}

{% block projectinfomain %}
<script src="{% static 'js/machines.js' %}"></script>
<script>

  $(document).ready(function (){
    var ctx = {
      projectPageUrl : "{% url 'project' project.id %}",
      projectName : "{{project.name}}",
      xhrEditProjectUrl : "{% url 'xhr_projectedit' project.id %}",
      projectId : {{project.id}},
      xhrDataTypeaheadUrl : "{% url 'xhr_datatypeahead' %}",
    };

    try {
      machinesPageInit(ctx);
    } catch (e) {
      document.write("Sorry, An error has occurred loading this page");
      console.warn(e);
    }
  });
</script>
{% include "layers_dep_modal.html" %}
<div class="page-header">
  <h1>
    All machines
    <i class="icon-question-sign get-help heading-help" title="This page lists all the machines compatible with the current project that Toaster knows about. They include community-created targets suitable for use on top of OpenEmbedded Core and any targets you have imported"></i>
  </h1>
</div>

<div class="alert alert-info lead" id="alert-area" style="display:none">
  <button type="button" class="close" id="dismiss-alert">&times;</button>
  <span id="alert-msg"></span>
</div>

{% include "basetable_top.html" %}
{% for o in objects %}
<tr class="data">
  <td class="machine">{{o.name}}</td>
  <td class="description">{{o.description}}</td>
  <td class="layer"><a href="{%url "layerdetails" o.layer_version.id %}">{{o.layer_version.layer.name}}</a></td>
  <td class="source">{{o.layer_source.name}}</td>
  <td class="branch">{{o.layer_version.commit}}</td>
  <td class="machinefile"><code>/machine/conf/{{o.name}}.conf</code><a href="{{o.get_vcs_machine_file_link_url}}" target="_blank"><i class="icon-share get-info"></i></a></td>
  <td class="select-or-add">
    <a href="#" class="btn btn-block select-machine-btn" data-machine-name="{{o.name}}" data-layer-version-id="{{o.layer_version.id}}"
        {%if o.layer_version.id not in project_layers %}style="display:none" {%endif%}  >Select machine</a>
    <a  href="#" class="btn btn-block nopop add-layer" data-layer-version-id="{{o.layer_version.id}}" data-layer-name="{{o.layer_version.layer.name}}" {%if o.layer_version.id in project_layers %}style="display:none" {%endif%}
        >
      <i class="icon-plus"></i>
      Add layer
      <i class="icon-question-sign get-help" title="To build this machine, you must first add the {{o.layer_version.layer.name}} layer to your project"></i>
    </a>
  </td>
</tr>
{% endfor %}

{% include "basetable_bottom.html" %}

{% endblock %}
